<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torres de Palabras - Sky Edition</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Fredoka:wght@400;700&display=swap');

        body {
            font-family: 'Fredoka', sans-serif;
            overflow: hidden;
            touch-action: manipulation;
        }

        .pixel-font {
            font-family: 'Press Start 2P', cursive;
        }

        /* Cielo y Nubes Animadas */
        .sky-bg {
            background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%);
            position: relative;
            overflow: hidden;
        }

        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50px;
            animation: floatCloud linear infinite;
        }
        
        .cloud::after, .cloud::before {
            content: '';
            position: absolute;
            background: inherit;
            border-radius: 50%;
        }

        @keyframes floatCloud {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100vw); }
        }

        /* Bloques de la Torre */
        .tower-block {
            width: 100%;
            height: 20px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: 2px solid #B8860B;
            border-radius: 4px;
            box-shadow: inset 2px 2px 0px rgba(255,255,255,0.3), inset -2px -2px 0px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .tower-container {
            transition: height 1s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Animaciones UI */
        .pop-in { animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        
        @keyframes popIn {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Suelo */
        .ground {
            background: 
                linear-gradient(to bottom, #4ade80 0%, #22c55e 20%, #15803d 100%);
            border-top: 8px solid #86efac;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- CONSTANTES ---
        const CATEGORIAS = [
            "Frutas", "Países", "Marcas de Coche", "Colores", "Animales", 
            "Partes del Cuerpo", "Verbos", "Cosas de cocina", "Deportes", 
            "Instrumentos", "Capitales", "Nombres Propios", "Ropa", 
            "Cosas Redondas", "Videojuegos", "Superhéroes", "Comida Basura", 
            "Bebidas", "Villanos", "Cosas Verdes"
        ];

        // --- FIREBASE SETUP ---
        // Usamos variables globales inyectadas o fallback seguro
        const firebaseConfig = JSON.parse(window.__firebase_config || '{}');
        const appId = window.__app_id || 'default-app';
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- COMPONENTES ---

        // Iconos
        const Icon = ({ name, size = 24, className }) => {
            React.useEffect(() => {
                lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        // Generar Código
        const generateRoomCode = () => {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let result = '';
            for (let i = 0; i < 4; i++) result += chars.charAt(Math.floor(Math.random() * chars.length));
            return result;
        };

        // --- APP PRINCIPAL ---
        function App() {
            const [user, setUser] = React.useState(null);
            const [mode, setMode] = React.useState(null);

            React.useEffect(() => {
                const initAuth = async () => {
                    if (window.__initial_auth_token) {
                        await auth.signInWithCustomToken(window.__initial_auth_token);
                    } else {
                        await auth.signInAnonymously();
                    }
                };
                initAuth();
                return auth.onAuthStateChanged(u => setUser(u));
            }, []);

            if (!user) return <div className="h-screen w-full bg-sky-300 flex items-center justify-center text-white font-bold text-2xl">Cargando Nubes...</div>;

            if (!mode) {
                return (
                    <div className="min-h-screen sky-bg flex flex-col items-center justify-center p-4">
                        {/* Nubes decorativas */}
                        <div className="cloud w-32 h-12 top-10 left-10" style={{animationDuration: '20s'}}></div>
                        <div className="cloud w-48 h-16 top-32 right-20" style={{animationDuration: '25s'}}></div>

                        <div className="bg-white/90 backdrop-blur-md p-8 rounded-3xl shadow-2xl max-w-2xl w-full text-center border-b-8 border-blue-200">
                            <h1 className="text-5xl md:text-6xl font-black mb-2 text-blue-600 drop-shadow-sm tracking-tight">
                                SKY TOWERS
                            </h1>
                            <p className="text-slate-500 mb-8 font-medium">Construye la torre más alta con las palabras más cortas.</p>
                            
                            <div className="grid md:grid-cols-2 gap-6">
                                <button onClick={() => setMode('host')} className="group flex flex-col items-center p-6 bg-blue-50 rounded-2xl border-4 border-blue-100 hover:border-blue-400 hover:bg-blue-100 transition-all hover:-translate-y-1">
                                    <div className="bg-blue-500 text-white p-4 rounded-full mb-4 shadow-lg group-hover:scale-110 transition-transform">
                                        <Icon name="monitor" size={40} />
                                    </div>
                                    <h2 className="text-xl font-bold text-blue-900">Soy la Pantalla</h2>
                                    <p className="text-sm text-blue-600/70">Para TV o Proyector</p>
                                </button>

                                <button onClick={() => setMode('player')} className="group flex flex-col items-center p-6 bg-green-50 rounded-2xl border-4 border-green-100 hover:border-green-400 hover:bg-green-100 transition-all hover:-translate-y-1">
                                    <div className="bg-green-500 text-white p-4 rounded-full mb-4 shadow-lg group-hover:scale-110 transition-transform">
                                        <Icon name="smartphone" size={40} />
                                    </div>
                                    <h2 className="text-xl font-bold text-green-900">Soy Jugador</h2>
                                    <p className="text-sm text-green-600/70">Desde el Móvil</p>
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return mode === 'host' ? <HostView user={user} /> : <PlayerView user={user} />;
        }

        // --- VISTA DEL HOST (TV) ---
        function HostView({ user }) {
            const [roomCode, setRoomCode] = React.useState('');
            const [gameState, setGameState] = React.useState('LOBBY');
            const [players, setPlayers] = React.useState({});
            const [timer, setTimer] = React.useState(0);
            const [currentCategory, setCurrentCategory] = React.useState('');

            // Inicializar Sala
            React.useEffect(() => {
                const code = generateRoomCode();
                setRoomCode(code);
                
                const roomRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(code);
                
                roomRef.set({
                    hostId: user.uid,
                    status: 'LOBBY',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    currentCategory: '',
                });

                const unsubscribe = roomRef.collection('players').onSnapshot(snap => {
                    const pData = {};
                    snap.forEach(d => pData[d.id] = d.data());
                    setPlayers(pData);
                });

                return () => unsubscribe();
            }, [user]);

            // Timer Loop
            React.useEffect(() => {
                let interval;
                if (gameState === 'PLAYING' && timer > 0) {
                    interval = setInterval(() => setTimer(t => t - 1), 1000);
                } else if (gameState === 'PLAYING' && timer === 0) {
                    endRound();
                }
                return () => clearInterval(interval);
            }, [gameState, timer]);

            const nextRound = async () => {
                const category = CATEGORIAS[Math.floor(Math.random() * CATEGORIAS.length)];
                const roomRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomCode);
                
                const batch = db.batch();
                
                // Resetear jugadores
                Object.keys(players).forEach(pid => {
                    const pRef = roomRef.collection('players').doc(pid);
                    batch.update(pRef, { currentWord: '', submitted: false });
                });

                // Actualizar sala
                batch.update(roomRef, {
                    status: 'PLAYING',
                    currentCategory: category,
                    roundEndTime: Date.now() + 30000
                });

                await batch.commit();
                
                setCurrentCategory(category);
                setGameState('PLAYING');
                setTimer(30);
            };

            const endRound = async () => {
                setGameState('REVEAL');
                
                // Actualizar DB para que los jugadores vean que acabó
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomCode)
                    .update({ status: 'REVEAL' });

                calculateScores();
            };

            const calculateScores = async () => {
                const validPlayers = Object.entries(players).filter(([_, p]) => p.submitted && p.currentWord.trim().length > 0);
                if (validPlayers.length === 0) return;

                const wordGroups = {};
                validPlayers.forEach(([pid, p]) => {
                    const w = p.currentWord.trim().toUpperCase();
                    if (!wordGroups[w]) wordGroups[w] = [];
                    wordGroups[w].push(pid);
                });

                const batch = db.batch();
                const roomRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomCode);

                validPlayers.forEach(([pid, p]) => {
                    const w = p.currentWord.trim().toUpperCase();
                    const pRef = roomRef.collection('players').doc(pid);
                    
                    if (wordGroups[w].length > 1) {
                        // Repetida - 0 Puntos
                    } else {
                        // Palabra corta = Más bloques
                        // Fórmula: 15 - longitud (min 2 bloques)
                        let blocks = Math.max(2, 15 - w.length);
                        // Bonus si es muy corta (<4 letras)
                        if (w.length < 4) blocks += 2;
                        
                        batch.update(pRef, { 
                            towerHeight: firebase.firestore.FieldValue.increment(blocks),
                            lastBlocks: blocks
                        });
                    }
                });

                await batch.commit();
            };

            // --- RENDER HOST ---

            if (gameState === 'LOBBY') {
                return (
                    <div className="h-screen sky-bg flex flex-col items-center justify-center p-8 relative">
                        {/* Nubes Fondo */}
                        <div className="cloud w-64 h-24 top-20 left-20 opacity-50" style={{animationDuration: '40s'}}></div>
                        <div className="cloud w-40 h-16 bottom-40 right-40 opacity-50" style={{animationDuration: '30s'}}></div>

                        <div className="bg-white/90 backdrop-blur rounded-[3rem] p-12 text-center shadow-2xl max-w-3xl w-full border-4 border-white/50 animate-pop-in">
                            <p className="text-blue-500 font-bold tracking-widest uppercase mb-2">Únete en tu móvil</p>
                            <h1 className="text-8xl font-black text-slate-800 mb-8 pixel-font tracking-widest">{roomCode}</h1>
                            
                            <div className="bg-slate-100 rounded-3xl p-6 min-h-[120px] mb-8">
                                <h3 className="text-slate-400 font-bold mb-4 flex justify-center items-center gap-2">
                                    <Icon name="users" size={20}/> JUGADORES ({Object.keys(players).length})
                                </h3>
                                <div className="flex flex-wrap justify-center gap-3">
                                    {Object.values(players).map((p, i) => (
                                        <div key={i} className="bg-white px-4 py-2 rounded-xl shadow-sm border border-slate-200 font-bold text-slate-700 animate-pop-in flex items-center gap-2">
                                            <div className="w-2 h-2 rounded-full bg-green-500"></div> {p.name}
                                        </div>
                                    ))}
                                    {Object.keys(players).length === 0 && <span className="text-slate-400 italic">Esperando constructores...</span>}
                                </div>
                            </div>

                            <button onClick={nextRound} disabled={Object.keys(players).length === 0} 
                                className="w-full bg-blue-600 hover:bg-blue-500 text-white text-2xl font-black py-6 rounded-2xl shadow-lg shadow-blue-500/30 transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                                INICIAR JUEGO
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="h-screen sky-bg flex flex-col relative">
                    {/* Elementos Decorativos Cielo */}
                    <div className="cloud w-56 h-20 top-10 left-10 opacity-80" style={{animationDuration: '60s'}}></div>
                    <div className="cloud w-40 h-14 top-24 right-20 opacity-60" style={{animationDuration: '45s'}}></div>
                    <div className="absolute top-10 left-1/2 -translate-x-1/2 w-32 h-32 bg-yellow-300 rounded-full blur-3xl opacity-40"></div>

                    {/* HUD Superior */}
                    <div className="absolute top-6 left-6 right-6 flex justify-between items-start z-20">
                        <div className="bg-white/90 backdrop-blur px-6 py-3 rounded-2xl shadow-lg border-2 border-white">
                            <div className="text-xs font-bold text-slate-400 uppercase">Sala</div>
                            <div className="text-2xl font-black text-slate-800 font-mono">{roomCode}</div>
                        </div>

                        {gameState === 'PLAYING' && (
                            <div className="bg-white/90 backdrop-blur px-10 py-6 rounded-[2rem] shadow-2xl border-4 border-blue-200 text-center transform hover:scale-105 transition-transform">
                                <div className="text-sm font-bold text-blue-400 uppercase tracking-widest mb-1">Categoría</div>
                                <div className="text-4xl font-black text-slate-800">{currentCategory}</div>
                            </div>
                        )}

                        <div className={`bg-white/90 backdrop-blur w-20 h-20 flex items-center justify-center rounded-full shadow-lg border-4 ${timer < 10 ? 'border-red-400 text-red-500 animate-pulse' : 'border-white text-slate-700'}`}>
                            <span className="text-3xl font-black font-mono">{timer}</span>
                        </div>
                    </div>

                    {/* Escenario de Juego */}
                    <div className="flex-1 flex items-end justify-center gap-2 md:gap-4 px-8 pb-[10vh] z-10 w-full overflow-x-auto">
                        {Object.entries(players).map(([pid, p], i) => {
                            const isSubmitted = p.submitted && gameState === 'PLAYING';
                            const isRevealed = gameState === 'REVEAL';
                            // Altura visual base + bloques ganados
                            const height = p.towerHeight || 0;
                            // Calcular si ganó bloques esta ronda (simple diff check visual or logic)
                            const isWinner = isRevealed && p.lastBlocks > 0 && !Object.values(players).some(op => op.currentWord === p.currentWord && op !== p);

                            return (
                                <div key={pid} className="flex flex-col items-center justify-end h-full min-w-[80px] md:min-w-[120px] transition-all">
                                    
                                    {/* Burbuja de Palabra */}
                                    <div className={`mb-2 transition-all duration-500 transform 
                                        ${isRevealed ? 'opacity-100 translate-y-0 scale-100' : 'opacity-0 translate-y-10 scale-0'}
                                    `}>
                                        <div className={`px-3 py-2 rounded-xl text-center shadow-lg font-bold border-2 relative
                                            ${p.currentWord && Object.values(players).filter(pl => pl.currentWord && pl.currentWord.toUpperCase() === p.currentWord.toUpperCase()).length > 1 
                                                ? 'bg-red-100 border-red-300 text-red-600 line-through decoration-4' 
                                                : 'bg-white border-white text-slate-800'
                                            }
                                        `}>
                                            {p.currentWord || "..."}
                                            {/* Triangulito burbuja */}
                                            <div className="absolute top-full left-1/2 -translate-x-1/2 border-8 border-transparent border-t-white"></div>
                                        </div>
                                    </div>

                                    {/* Torre de Bloques */}
                                    <div className="w-full flex flex-col-reverse items-center justify-end transition-all duration-1000 ease-out relative" 
                                         style={{height: `${Math.min(height * 20, 600)}px`}}>
                                        
                                        {/* Avatar/Cabeza encima de la torre */}
                                        <div className="absolute -top-12 w-10 h-10 bg-white rounded-full border-2 border-slate-300 shadow-sm flex items-center justify-center z-10">
                                            <span className="text-xs font-bold">{p.name.substring(0,2).toUpperCase()}</span>
                                            {isSubmitted && <div className="absolute -right-1 -top-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white animate-bounce"></div>}
                                        </div>

                                        {/* Renderizar bloques individuales visualmente si no son demasiados, sino usar altura */}
                                        {/* Simplificación visual: Un div que crece con patrón repetido */}
                                        <div className="w-16 md:w-20 bg-yellow-400 border-x-2 border-yellow-600 h-full relative overflow-hidden rounded-t-lg shadow-xl flex flex-col justify-end">
                                            {/* Patrón de ladrillos CSS */}
                                            <div className="w-full h-full opacity-30" style={{
                                                backgroundImage: 'linear-gradient(335deg, rgba(0,0,0,0.1) 23px, transparent 23px), linear-gradient(155deg, rgba(0,0,0,0.1) 23px, transparent 23px), linear-gradient(335deg, rgba(0,0,0,0.1) 23px, transparent 23px), linear-gradient(155deg, rgba(0,0,0,0.1) 23px, transparent 23px)',
                                                backgroundSize: '58px 58px',
                                                backgroundColor: '#F59E0B'
                                            }}></div>
                                            
                                            {/* Overlay de brillo */}
                                            <div className="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent pointer-events-none"></div>
                                        </div>
                                    </div>

                                    {/* Nombre en el suelo */}
                                    <div className="mt-2 bg-black/20 text-white px-3 py-1 rounded-full text-xs font-bold backdrop-blur-sm">
                                        {height}m
                                    </div>
                                    <div className="text-white font-bold text-sm mt-1 drop-shadow-md truncate max-w-full">
                                        {p.name}
                                    </div>

                                </div>
                            );
                        })}
                    </div>

                    {/* Suelo */}
                    <div className="ground h-[10vh] w-full z-20 relative shadow-[0_-10px_40px_rgba(0,0,0,0.2)]"></div>

                    {/* Botón Siguiente (Host Overlay) */}
                    {gameState === 'REVEAL' && (
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 animate-pop-in">
                            <button onClick={nextRound} className="bg-white text-blue-600 px-10 py-5 rounded-full font-black text-2xl shadow-[0_20px_50px_rgba(0,0,0,0.3)] hover:scale-110 hover:rotate-2 transition-all border-4 border-blue-100 flex items-center gap-3">
                                <span>SIGUIENTE RONDA</span> <Icon name="arrow-right" />
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        // --- VISTA DEL JUGADOR (MÓVIL) ---
        function PlayerView({ user }) {
            const [roomCode, setRoomCode] = React.useState('');
            const [name, setName] = React.useState('');
            const [joined, setJoined] = React.useState(false);
            const [gameState, setGameState] = React.useState('WAITING');
            const [category, setCategory] = React.useState('');
            const [inputWord, setInputWord] = React.useState('');
            const [submitted, setSubmitted] = React.useState(false);
            const [error, setError] = React.useState('');

            React.useEffect(() => {
                if (!joined || !roomCode) return;

                const roomRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomCode);
                
                const unsub = roomRef.onSnapshot(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        setGameState(data.status);
                        setCategory(data.currentCategory);
                    } else {
                        setJoined(false);
                        setError('Sala cerrada');
                    }
                });

                const playerRef = roomRef.collection('players').doc(user.uid).onSnapshot(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        if (!data.submitted && submitted) {
                            setSubmitted(false);
                            setInputWord('');
                        }
                    }
                });

                return () => { unsub(); playerRef(); };
            }, [joined, roomCode]);

            const joinRoom = async (e) => {
                e.preventDefault();
                if(!roomCode || !name) return;
                const code = roomCode.toUpperCase();
                
                const roomRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(code);
                const docSnap = await roomRef.get();

                if (docSnap.exists) {
                    await roomRef.collection('players').doc(user.uid).set({
                        name, towerHeight: 0, score: 0, currentWord: '', submitted: false
                    });
                    setRoomCode(code);
                    setJoined(true);
                } else {
                    setError('Sala no encontrada');
                }
            };

            const submitWord = async (e) => {
                e.preventDefault();
                if (!inputWord.trim()) return;
                
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomCode)
                    .collection('players').doc(user.uid).update({
                        currentWord: inputWord.trim(),
                        submitted: true
                    });
                setSubmitted(true);
            };

            if (!joined) {
                return (
                    <div className="min-h-screen sky-bg p-6 flex flex-col justify-center">
                        <div className="bg-white/95 backdrop-blur rounded-3xl p-6 shadow-xl border-4 border-white/50">
                            <h1 className="text-2xl font-black text-center text-blue-600 mb-6 uppercase">Entrar al Juego</h1>
                            <form onSubmit={joinRoom} className="space-y-4">
                                <div>
                                    <label className="text-xs font-bold text-slate-400 uppercase ml-1">Código TV</label>
                                    <input value={roomCode} onChange={e => setRoomCode(e.target.value.toUpperCase())} maxLength={4}
                                        className="w-full bg-slate-100 border-2 border-slate-200 rounded-xl py-4 text-center text-3xl font-mono font-bold text-slate-800 uppercase focus:border-blue-500 outline-none" placeholder="ABCD" />
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-slate-400 uppercase ml-1">Tu Nombre</label>
                                    <input value={name} onChange={e => setName(e.target.value)}
                                        className="w-full bg-slate-100 border-2 border-slate-200 rounded-xl py-4 px-4 text-xl font-bold text-slate-800 focus:border-blue-500 outline-none" placeholder="Nombre" />
                                </div>
                                {error && <p className="text-red-500 text-center font-bold text-sm">{error}</p>}
                                <button type="submit" className="w-full bg-green-500 hover:bg-green-600 text-white font-black py-4 rounded-xl text-lg shadow-lg shadow-green-500/30 transition-transform active:scale-95">
                                    ¡A VOLAR!
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }

            // Waiting / Lobby State
            if (gameState === 'LOBBY') {
                return (
                    <div className="min-h-screen sky-bg flex flex-col items-center justify-center p-8 text-center">
                        <div className="bg-white/20 backdrop-blur-md rounded-full p-8 mb-6 animate-bounce">
                            <Icon name="coffee" size={48} className="text-white" />
                        </div>
                        <h2 className="text-3xl font-black text-white mb-2">¡Hola {name}!</h2>
                        <p className="text-blue-100 font-medium">Mira a la pantalla grande, el juego empezará pronto.</p>
                    </div>
                );
            }

            // Reveal State
            if (gameState === 'REVEAL') {
                return (
                    <div className="min-h-screen sky-bg flex flex-col items-center justify-center p-8 text-center">
                        <h2 className="text-3xl font-black text-white mb-6 drop-shadow-md">Ronda Finalizada</h2>
                        <div className="bg-white rounded-2xl p-6 w-full shadow-xl">
                            <p className="text-slate-400 text-xs font-bold uppercase mb-1">Tu palabra fue</p>
                            <p className="text-2xl font-black text-slate-800 break-all">{inputWord || "-"}</p>
                        </div>
                        <p className="mt-8 text-white/80 animate-pulse">Calculando alturas...</p>
                    </div>
                );
            }

            // Playing State
            return (
                <div className="min-h-screen sky-bg flex flex-col p-4">
                    <div className="flex-1 flex flex-col justify-center w-full max-w-md mx-auto">
                        <div className="bg-white/10 backdrop-blur-md rounded-2xl p-6 mb-8 text-center border border-white/20">
                            <span className="text-blue-100 text-xs font-bold uppercase tracking-widest">Categoría</span>
                            <h2 className="text-3xl font-black text-white mt-1 drop-shadow-md">{category}</h2>
                        </div>

                        {!submitted ? (
                            <form onSubmit={submitWord} className="w-full space-y-4 animate-pop-in">
                                <input 
                                    value={inputWord} onChange={e => setInputWord(e.target.value)}
                                    placeholder="Palabra corta..." autoFocus
                                    className="w-full bg-white text-slate-800 text-3xl font-black text-center py-8 rounded-3xl shadow-2xl border-4 border-white focus:border-blue-400 outline-none"
                                />
                                <button type="submit" className="w-full bg-gradient-to-b from-yellow-400 to-orange-500 text-white font-black text-2xl py-6 rounded-3xl shadow-xl shadow-orange-500/40 active:scale-95 transition-transform border-b-8 border-orange-600 active:border-b-0 active:translate-y-2">
                                    ENVIAR
                                </button>
                                <p className="text-center text-blue-100 text-sm font-medium mt-4">
                                    Escribe la palabra VÁLIDA más CORTA posible.<br/>Si repites, no subes.
                                </p>
                            </form>
                        ) : (
                            <div className="text-center animate-pop-in">
                                <div className="bg-green-500 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl border-4 border-white">
                                    <Icon name="check" size={48} className="text-white" />
                                </div>
                                <h3 className="text-3xl font-black text-white drop-shadow-md">¡Enviado!</h3>
                                <div className="mt-8 bg-white/20 rounded-xl p-4 backdrop-blur">
                                    <span className="text-blue-100 text-xs uppercase">Palabra enviada</span>
                                    <p className="text-2xl font-bold text-white">{inputWord}</p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
